(import (rt util))

(add-test test-to-csv:
 (lambda ()
   (.assert_eq *TC*
               "\"1:2:3\\r\\n4:5:6\\r\\n\""
               (write-str (util-to-csv [[1 2 3] [4 5 6]] ":")))))
(add-test test-to-csv-2:
 (lambda ()
   (.assert_eq *TC*
               "\"1:2:3;4:5:6;\""
               (write-str (util-to-csv [[1 2 3] [4 5 6]] ":" ";")))))

(add-test test-from-csv:
 (lambda ()
   (.assert_eq *TC*
               (write-str [["1" "2" "3"] ["4" "5" "6"]])
               (write-str (util-from-csv (util-to-csv [[1 2 3] [4 5 6]]
                                                      ":" ";")
                                         ":" ";")))))

(add-test test-from-csv-noeol:
 (lambda ()
   (.assert_eq *TC*
               (write-str [["1" "2" "3"] ["4" "5" "6"]])
               (write-str (util-from-csv "1:2:3;4:5:6" ":" ";")))))

(add-test test-from-csv-quoted:
 (lambda ()
   (.assert_eq *TC*
               (write-str [["foo\"bar"] ["XXX"]])
               (write-str (util-from-csv "\"foo\"\"bar\";XXX" ":" ";")))))

(displayln (write-str (util-from-csv "500394;;;;;\"Stahlbetonbrücke 9 x 3 m  -  30 t SLW, Bewehrungs- & Schalplan\";;;;\n500395;;;;;\"Statische Berechnung – Fertigkeitsberechnung 9 x 3 m – 30 t  Blatt 1 – 13\";;;;\n" ";" "\r\n")))
